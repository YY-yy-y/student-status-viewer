<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç—É—Å —Å—Ç—É–¥–µ–Ω—Ç–∞</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëÄ</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @keyframes pulse-green {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }
        .pulse-live {
            animation: pulse-green 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div id="container" class="w-full max-w-lg mx-auto bg-gray-800 rounded-2xl shadow-2xl p-8 text-center hidden">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-100">–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h1>
        
        <div class="mt-8 p-6 bg-gray-700 rounded-xl">
            <p class="text-lg text-gray-400">–°—Ç–∞—Ç—É—Å:</p>
            <p id="statusDisplay" class="text-3xl md:text-4xl font-semibold mt-2 break-words">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <div class="mt-6 p-6 bg-gray-700 rounded-xl">
            <p class="text-lg text-gray-400">–ú–æ–∂–Ω–æ –ª–∏ –∑–≤–æ–Ω–∏—Ç—å?</p>
            <div id="callIndicator" class="flex items-center justify-center mt-3 space-x-3">
                <div id="callIndicatorDot" class="w-6 h-6 rounded-full bg-gray-500"></div>
                <span id="callIndicatorText" class="text-2xl font-medium">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <div class="mt-8 text-sm text-gray-500">
            <p>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</p>
            <p id="timestamp" class="mt-1 font-mono">--:--:--</p>
        </div>
    </div>
    
    <div id="auth" class="text-center p-4">
        <h2 class="text-2xl font-bold text-yellow-400">–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <p id="authMessage" class="mt-2 text-gray-300">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞.</p>
    </div>


    <!-- Firebase -->
    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyD6-u1gFwpSzIxxtFMv9fZTg-4MugyJlbk",
            authDomain: "status-viewer-7695d.firebaseapp.com",
            projectId: "status-viewer-7695d",
            storageBucket: "status-viewer-7695d.appspot.com",
            messagingSenderId: "430748222191",
            appId: "1:430748222191:web:d3625dd9878140c7c0511a",
            measurementId: "G-X61112HJHQ"
        };
        
        //
        // –ò–ó–ú–ï–ù–ò–¢–ï –°–ï–ö–†–ï–¢–ù–´–ô –ö–õ–Æ–ß –ó–î–ï–°–¨
        //
        const SECRET_KEY = "none";
        // -----------------------------------------------------

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        function startApp() {
            let db;
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
            } catch (e) {
                console.error("Firebase initialization failed:", e);
                document.getElementById('statusDisplay').textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                document.getElementById('callIndicatorText').textContent = '–û—à–∏–±–∫–∞';
                return;
            }

            const statusDisplay = document.getElementById('statusDisplay');
            const callIndicatorDot = document.getElementById('callIndicatorDot');
            const callIndicatorText = document.getElementById('callIndicatorText');
            const timestampDisplay = document.getElementById('timestamp');

            const statusRef = doc(db, "studentStatus", "current_status");
            onSnapshot(statusRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    statusDisplay.textContent = data.status || "–°—Ç–∞—Ç—É—Å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω";

                    if (data.canCall) {
                        callIndicatorDot.className = 'w-6 h-6 rounded-full bg-green-500 pulse-live';
                        callIndicatorText.textContent = "–ú–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å";
                        callIndicatorText.style.color = '#22c55e'; // green-500
                    } else {
                        callIndicatorDot.className = 'w-6 h-6 rounded-full bg-red-500';
                        callIndicatorText.textContent = "–ó–∞–Ω—è—Ç(–∞)";
                        callIndicatorText.style.color = '#ef4444'; // red-500
                    }

                    if (data.updatedAt && data.updatedAt.toDate) {
                        const date = data.updatedAt.toDate();
                        timestampDisplay.textContent = date.toLocaleString('ru-RU', { dateStyle: 'medium', timeStyle: 'short' });
                    } else {
                        timestampDisplay.textContent = "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
                    }
                } else {
                    statusDisplay.textContent = "–°—Ç—É–¥–µ–Ω—Ç –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª —Å—Ç–∞—Ç—É—Å.";
                    callIndicatorText.textContent = "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
                }
            }, (error) => {
                console.error("Error listening to document: ", error);
                statusDisplay.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
            });
        }

        const urlParams = new URLSearchParams(window.location.search);
        const providedKey = urlParams.get('key');
        const container = document.getElementById('container');
        const authDiv = document.getElementById('auth');

        if (providedKey === SECRET_KEY) {
            authDiv.style.display = 'none';
            container.classList.remove('hidden');
            startApp();
        } else {
            authDiv.style.display = 'block';
            console.warn("Access denied. Invalid or missing key.");
        }
    </script>
</body>
</html>

